<!DOCTYPE html>
<head>
  <title>Wiki</title>
  <link rel="icon" href="icon-120.png" />
  <link rel="stylesheet" href="./@observablehq/inspector@5/dist/inspector.css" />
  <script type="module">
   import {Runtime, Inspector} from './@observablehq/runtime@5/dist/runtime.js';
   import {Library} from './src/library.js';
   import {notebook} from './src/notebook.js';
   import {Plugins} from './src/plugins/index.js';
   const notebookFromPanel = notebook(Plugins);

   function randomId() {
     let x = new Uint32Array(2);
     crypto.getRandomValues(x);
     return Array.from(x, i=>i.toString(16)).join('');
   }

   function intentFromLocation(location) {
     let params = new URLSearchParams(location.search);
     if (params.has('url')) {
       return {
         intent: 'fetch',
         url: new URL(params.get('url'), location.origin)
       };
     }
     return {
       intent: 'unknown'
     };
   }
   window.onload = async () => {
     let action = intentFromLocation(location);
     if (action.intent === 'unknown') return;
     const runtime = new Runtime(Library);
     if (action.intent === 'fetch') {
       const res = await fetch(action.url, {mode: 'cors'});
       const page = await res.json();
       const panel = {
         id: randomId(), flag: '',
         page
       };
       const module = runtime.module(
         notebookFromPanel(panel),
         name => (name == 'panel') ? Inspector.into('main')() : null);
     }

   };
  </script>
</head>
<main></main>
